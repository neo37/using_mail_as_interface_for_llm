- **`agent_logic.py`**: здесь сосредоточены все классы и функции, связанные с LLM-логикой (SupplierLLMAgent), хранением данных (SupplierDataManager), отправкой писем (YandexEmailSender) и сохранением в Excel (save_supplier_data_to_excel).  
- **`mail_receiver.py`**: тут мы занимаемся приёмом почты (через IMAP), обращаемся к методам из `agent_logic.py`, и запускаем бесконечный цикл, обрабатывающий новые письма.

### Структура проекта

```
your_project/
  ├─ .env
  ├─ agent_logic.py
  ├─ mail_receiver.py
  ├─ requirements.txt (опционально)
  └─ ...
```
## Объяснение `mail_receiver.py`

- Загружается `.env` ещё раз (`load_dotenv()`), чтобы переменные окружения были доступны.
- **YandexEmailReceiver** работает через `IMAP4_SSL` и ищет письма с флагом `UNSEEN`.  
- В `main()` мы:
  1. Создаём объекты (LLM-агент, хранитель данных, приёмник писем, отправитель писем).
  2. В бесконечном цикле получаем список новых писем, обрабатываем их.  
  3. С помощью `llm_agent.parse_supplier_answer` извлекаем данные.  
  4. Сохраняем в `data_manager`.  
  5. Если данные **все** есть → сохраняем в Excel, пишем поставщику «всё ок».  
  6. Если не все → генерируем уточняющий вопрос и отсылаем обратно.

# Инструкция по запуску

1. **Установите зависимости**  
   Создайте (опционально) файл `requirements.txt` со списком пакетов:
   ```
   openai
   python-dotenv
   openpyxl
   ```
   Затем выполните:
   ```bash
   pip install -r requirements.txt
   ```
   или установите пакеты вручную:
   ```bash
   pip install openai python-dotenv openpyxl
   ```

2. **Создайте файл `.env`** в корне проекта (рядом с `mail_receiver.py` и `agent_logic.py`). Пример содержимого:
   ```bash
   OPENAI_API_KEY=your_openai_api_key
   YANDEX_EMAIL=your_yandex_email@yandex.ru
   YANDEX_PASSWORD=your_yandex_password
   IMAP_SERVER=imap.yandex.ru
   SMTP_SERVER=smtp.yandex.ru
   SMTP_PORT=587
   ```
   Подставьте реальные значения!

3. **Запустите скрипт `mail_receiver.py`:**
   ```bash
   python mail_receiver.py
   ```
   Скрипт будет каждые 60 секунд проверять входящие письма в Яндексе. Если придёт письмо от поставщика, LLM-агент постарается извлечь нужные параметры товара и при необходимости отправит уточняющие вопросы в ответ.

4. **Остановить скрипт** можно, нажав `Ctrl + C`. При остановке текущие данные будут сохранены в `suppliers_data.xlsx`.

---

## Дополнительные рекомендации

- **Продвинутые настройки:** 
  - Если нужно, вы можете дополнить `.env` другими переменными (например, `EXCEL_FILENAME=...` и т.д.).
  - Можно добавить логирование (через `logging`) вместо простых `print()`, чтобы писать логи в файл.
- **Развёртывание на сервере:**
  - Запустите скрипт в фоне (через `tmux`, `screen`, `nohup` или systemd). Например:
    ```bash
    nohup python mail_receiver.py > log.txt 2>&1 &
    ```
- **Хранение контекста:** 
  - Если вам важно вести **многократную** переписку с одним поставщиком, продумайте идентификацию цепочки (ID письма, «In-Reply-To» и т.д.), а также хранение истории вопросов-ответов (не только итоговых полей).
- **Безопасность:** 
  - Файл `.env` с паролями **не** должен попадать в публичные репозитории. Добавьте его в `.gitignore`.

Таким образом, у вас получатся два файла (`agent_logic.py` и `mail_receiver.py`), которые удобно поддерживать и расширять, а все ключи и логины будут лежать в `.env`, не светясь в репозитории. Удачи!
